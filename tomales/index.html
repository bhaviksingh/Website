<html>

<head>
    <script src="js/jquery.min.js"></script>
    <script src="js/poisson-disc-sampler.js"></script>
    <script src="js/garden.js"></script>
    <script src="js/tutorial.js"></script>
    <link rel="stylesheet" href="css/style.css" />
    <script>
        $(document).ready(function() {

            var garden, tutorial;
            var maxIndex, waitTime;
            var background = new Background("#entire-space");
            var buttonID = "#cursor-overlay";

            function setup() {
                garden = new Garden("#garden", 700, 700, 1); //Create a garden
                tutorial = new Tutorial("#tutorial-image");

                maxIndex = garden.getMaxIndex(); //We get the maxIndex from the garden
                waitTime = garden.getTimeBetweenFrames(3000);

                setupEvents();
            }
            setup();


            function setupEvents() {

                $(document).bind("contextmenu", function(e) {
                    return false;
                });


                $(buttonID).bind('touchstart mousedown', function(e) {
                    startAnimationDown()
                });


                $(buttonID).bind('touchend mouseup keyup', function(e) {
                    startAnimationUp()
                });
            }

            function startAnimationUp() {
                console.log("Animating up");
                direction = "up";
                renderNextFrame();
            }

            function startAnimationDown() {
                console.log("Animating down");
                direction = "down";
                renderNextFrame();
            }


            var direction = "pause"; //We're started in a paused state
            var currentIndex = maxIndex; //We're starting at the last frame
            var activeRenderer = tutorial;

            function renderNextFrame() {

                activeRenderer.updateToIndex(currentIndex);
                background.updateToIndex(currentIndex);

                if (direction == "pause") {
                    return;
                } else
                if (direction == "down") {
                    if (activeRenderer.reachedBottom(currentIndex)) {
                        console.log("Reached bottom");
                        direction = "pause";
                        return;

                    } else {
                        currentIndex -= 1;
                    }
                } else if (direction == "up") {
                    //If the user reaches the top, stop and tell the system to add a new flower (which happens the next time we hit the bottom)
                    if (activeRenderer.reachedTop(currentIndex)) {
                        console.log("Reached top");
                        direction = "pause";

                        if (activeRenderer.isFinished()) {
                            activeRenderer = garden;
                            garden.createGarden();
                        }

                        return;
                    } else {
                        currentIndex += 1;
                    }
                }
                setTimeout(function() {
                    renderNextFrame()
                }, waitTime);
            }


        });
    </script>

    <style>

    </style>
</head>

<body>
    <div id="cursor-overlay">
        <div id="tutorial-container">
            <div id="tutorial" class="tutorial">
                <img id="tutorial-image" />
            </div>

        </div>
    </div>

    <div id="background">
        <div id="entire-space">
        </div>
        <div id="garden-container">
            <div id="garden">
            </div>
        </div>
    </div>
    <div id="preload">

    </div>
</body>

</html>