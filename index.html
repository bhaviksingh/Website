<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>bvk</title>
    <link rel="shortcut icon" href="favicon.png" type="image/png" sizes="24x24">
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;1,400;1,500&display=swap" rel="stylesheet">


    <script src="jslib/poisson.js"></script>
    <script src="jslib/fabric.min.js"></script>
    <script src="jslib/utils.js"></script>
    <script src="jslib/moment.js"></script>
    <script src="jslib/moment-timezone-with-data.js"></script>

</head>

<body>
    <div id="header">
        <div id="logo"> </div>
        <div id="content">
            <div class="half"> <i>Bhavik </i> is an artist and technologist interested in creating digital experiences that help you express and understand yourself. </div>
            <div class="half">He's in <i>Brooklyn</i> where it is <span id="clock">x:xx</span>. You can reach him at <a href="mailto:bhaviksingh@gmail.com" target="_blank">bhaviksingh@gmail.com</a>, on <a href="instagram.com/bvksn">Instagram</a>, or <a href="https://www.are.na/bhavik-singh/">Arena</a>.
            </div>
        </div>
    </div>
    <div id="tools-container">
        <div id="play">
            <div class="slider-container">
                <div> <span id="refresh" style="text-decoration: underline; cursor: pointer;" onclick="layoutContent()"> Refresh layout </span>
                </div>
                <div>FG: <input type="range" min="1" max="360" value="251" oninput="updateColorHue('FGColor', this.value)"> </br>
                </div>
                <div> BG: <input type="range" min="1" max="360" value="55" oninput="updateColorHue('BGColor', this.value)"> </br>
                </div>
                <div> Br: <input type="range" min="1" max="360" value="55" oninput="updateColorHue('BrushColor', this.value)"></div>
            </div>
        </div>
    </div>
    <div id="container">

        <div id="content-holder">

            <!-- Breathe -->
            <div class="content browser not-google" data-priority="1">
                <div class="content-caption">
                    <div class="title"> <a href="bhaviksingh.com/breathe">Breathe</a> (2019/20)</div>
                    <div> a safe space!</div>
                </div>
                <div class="content-main">
                    <video muted loop poster="/Images/home/breathe-web-static.png" loop>
                    <source src="/Images/home/breathe-web.mov" type="video/mp4">
                  </video>
                </div>
            </div>
            <!-- Breathe -->
            <div class="content browser not-google" data-priority="1.3">
                <div class="content-caption">
                    <div class="title"> <a href="bhaviksingh.com/breathe">Breathe</a> (2019/20)</div>
                </div>
                <div class="content-main">
                    <video width="1920" height="1080" muted loop poster="/Images/home/breathe-phone-static.png" loop>
                      <source src="/Images/home/breathe-phone.mov"  type="video/mp4">
                    </video>
                </div>
            </div>
            <!-- Dinner at Ians -->
            <div class="content paper" data-priority="1">
                <div class="content-caption">
                    <div class="title"> <a href="dinneratians.com">Dinner at Ian's</a> (2019/20)</div>
                    <div> community dinner </div>
                </div>
                <div class="content-main"> <img draggable="false" src="/Images/home/dinner-at-ians.jpg" /> </div>
            </div>
            <!-- Shandar Phool -->
            <div class="content paper" data-priority="1">
                <div class="content-caption">
                    <div class="title"> Shandar Phool </a> (2020)</div>
                    <div> indian languages, flowers </div>
                </div>
                <div class="content-main" style="background: white"> <img draggable="false" src="/Images/home/shandar-phool.png" /> </div>
            </div>
            <!-- Emoji kitchen -->
            <div class="content browser" data-priority="1.2">
                <div class="content-caption">
                    <div class="title"> <a href="emoji.kitchen"> Emoji Kitchen</a> (2019) </div>
                    <div> make it ur own, emojis! </div>
                </div>
                <div class="content-main">
                    <video autoplay loop muted poster="/Images/home/emoji-kitchen-static.png" loop>
                      <source src="/Images/home/emoji-kitchen.mov" type="video/mp4">
                    </video>
                </div>
            </div>
            <!-- Smishy -->
            <div class="content paper" data-priority="1">
                <div class="content-caption">
                    <div class="title"> <a href="bhaviksingh.com/smishy"> Smishy </a> (2019)</div>
                    <div> creation as catharsis </div>
                </div>
                <div class="content-main">
                    <video muted loop poster="/Images/home/smishy-explainer-static.png" width="1104" height="704" loop>
                  <source src="/Images/home/smishy-explainer-small.mov" type="video/mp4">
                </video>
                </div>
            </div>
            <!-- Illustrations -->
            <div class="content paper" data-priority="1">
                <div class="content-caption">
                    <div class="title"> <a href="instagram.com/bybvk"> Misc illustrated vibes </a> (2019) </div>
                </div>
                <div class="content-main"> <img draggable="false" src="/Images/home/businessmen.jpg" /> </div>
            </div>
            <!-- Livegame.show -->
            <div class="content phone google" data-priority="1.5">
                <div class="content-caption">
                    <div class="title"><a href="www.livegame.show">Livegame.show</a> (2019) </div>
                    <div> Design @ Google </div>
                </div>
                <div class="content-main"> <img draggable="false" src="/Images/home/live-game-show.png" /> </div>
            </div>
            <!-- Minis  -->
            <div class="content phone google" data-priority="2">
                <div class="content-caption">
                    <div class="title"> <a href="details/detail-mini.html"> Minis </a> (2018/19)</div>
                    <div> Product Mgmt @ Google </div>
                </div>
                <div class="content-main">
                    <video muted loop poster="/Images/home/minis-create-flow-static.png">
                    <source src="/Images/home/minis-create-flow.mp4" type="video/mp4">
                   </video> </div>
            </div>
            <!-- Make a gif -->
            <div class="content phone google" data-priority="2">
                <div class="content-caption">
                    <div class="title"> <a href="details/detail-mag.html"> Make a gif </a> (2018/19)</div>
                    <div> Product Mgmt @ Google </div>
                </div>
                <div class="content-main">
                    <video muted loop poster="/Images/home/excam.png">
                     <source src="/Images/home/excam.mp4" type="video/mp4">
                    </video>
                </div>
            </div>
            <!-- Portraits -->
            <div class="content paper" data-priority="1.5">
                <div class="content-caption">
                    <div class="title"> <a href="instagram.com/bybvk"> Slow life, portrait series </a> (2018)</div>
                </div>
                <div class="content-main"> <img draggable="false" src="/Images/home/self-01.png" /> </div>
            </div>


        </div>
        <div id="canvas-holder">
            <canvas id="draw-canvas"></canvas>
        </div>
    </div>
    <script>
        displayProgress(" JS is starting");

        var contentHolder = document.getElementById("content-holder");
        var contentPieces = contentHolder.children;
        var windowSizeFactor = .4; //Controls how large the largest piece of content will be

        function setup() {
            setUpWindowSizeCalc();
            //Set up the right event listenere
            if (isDesktop() && !canvas) {
                createCanvas();
                window.addEventListener("resize", () => setCanvasSize());
                window.addEventListener("resize", () => setup());
            }
            //Pass 1: First resize all the content, and make it draggable
            for (var i = 0; i < contentPieces.length; i++) {
                var content = contentPieces[i];
                if (content.id == "play") {
                    continue;
                }
                resizeContent(content);
                makeDraggable(content);
            }
            //Pass 2: layout all the content
            layoutContent();

            //Pass 3: Setup all the video hovers
            setupVideoHover();

        }

        //ðŸ–¼ðŸ–¼ðŸ–¼ðŸ–¼ CONTENT LAYOUT RELATED FUNCTIONS 

        //Makes content draggable. 
        //TODO: Maybe consider making this only for a certin area.
        function makeDraggable(content) {
            let mouseDown = false;
            content.addEventListener("mousedown", () => {
                mouseDown = true;
            })

            document.addEventListener("mouseup", () => {
                mouseDown = false;
            });

            document.addEventListener("mousemove", (e) => {
                if (mouseDown) {
                    displayProgress("Moving the content", [e, content]);
                    var xPos = e.pageX;
                    var yPos = e.pageY;
                    content.style.left = xPos + "px";
                    content.style.top = yPos + "px";
                }
            });

        }

        //Gets the image for the content
        //TODO: Make this not jank
        function getImageForContent(content) {
            var contentMain = content.children[1];
            if (!contentMain)
                return null
            var contentImg = contentMain.children[0];
            return contentImg;
        }


        //Resize every piece of content.
        function resizeContent(content) {
            //First figure out if it has an image
            var contentImage = getImageForContent(content);
            if (!contentImage)
                return;
            //Get the priority of the image, default to 1
            var priority = content.dataset.priority;
            if (!priority)
                priority = 1;
            //Set the major/minor axis according to the aspect ratio of the image
            var sizeFactor = windowSizeFactor / priority;
            var majorAxisLength, windowMajorAxis;

            var contentWidth = contentImage.width;
            var contentHeight = contentImage.height;

            if (contentWidth == 0 || contentHeight == 0) {
                contentWidth = contentImage.clientWidth;
                contentHeight = contentImage.clientHeight;
            }
            var aspect = contentWidth / contentHeight;

            var objectToResize = contentImage;


            if (contentWidth > contentHeight) {
                majorAxisLength = sizeFactor * getWindowSize().width;
                contentImage.style.width = majorAxisLength + "px";
                contentImage.style.height = "auto";

                if (contentImage.tagName == "VIDEO") {
                    content.style.width = majorAxisLength + "px";
                    content.style.height = majorAxisLength / aspect + "px";
                }

            } else {
                majorAxisLength = sizeFactor * getWindowSize().height;
                contentImage.style.height = majorAxisLength + "px";
                contentImage.style.width = "auto";

                if (contentImage.tagName == "VIDEO") {
                    content.style.height = majorAxisLength + "px";
                    content.style.width = majorAxisLength * aspect + "px";
                }
            }
            // content.style.width = contentImage.clientWidth + "px";
            // content.style.height = contentImage.clientHeight + "px";
            displayProgress("Resizing /content to " + majorAxisLength, [contentImage]);
        }

        //Controller for layout
        function layoutContent() {

            //Arrange content as per constraints 
            if (!isDesktop() || getWindowSize().width < 850) {
                displayProgress("Entering mobile mode");
                arrangeVertically();
            } else {
                var areaSize = [contentHolder.clientWidth, contentHolder.clientHeight];
                var distanceBetweenContent = 0.4 * areaSize[1];
                var areaForContent = [0.8 * areaSize[0], 2 * areaSize[1]];
                arrangePoisson(areaForContent, distanceBetweenContent);
            }
            //Then like go ahead and do some basic edge detection cuz why not
            for (var i = 0; i < contentPieces.length; i++) {
                var content = contentPieces[i];
                borderDetection(content);
            }
        }


        //Arrange vertically 
        function arrangeVertically() {
            var paddingBetweenContent = 24;
            var currentTop = document.getElementById("header").getBoundingClientRect().bottom + paddingBetweenContent;


            for (var i = 0; i < contentPieces.length; i++) {
                var content = contentPieces[i];

                var contentTop = currentTop + Math.floor(Math.random() * 12);
                var spaceLeft = 0.5 * (getWindowSize().width - content.offsetWidth);
                var contentLeft = Math.floor(Math.random() * spaceLeft);

                displayProgress("Placing content at t " + contentTop + "  l " + contentLeft);

                content.style.top = contentTop + "px";
                content.style.left = contentLeft + "px";
                currentTop = contentTop + content.offsetHeight + paddingBetweenContent;
            }
        }



        //Poisson arrangement
        function arrangePoisson(poissonSize, distanceBetweenContent) {
            var sampler = poissonDiscSampler(poissonSize[0], poissonSize[1], distanceBetweenContent);

            for (var i = 0; i < contentPieces.length; i++) {
                var sample = sampler();
                if (!sample) {
                    arrangePoisson(poissonSize, distanceBetweenContent - 10);
                    return;
                }
                var content = contentPieces[i];
                //Left right edge detection and move
                var leftPos = sample[0],
                    topPos = sample[1];

                var headerBottom = document.getElementById("header").getBoundingClientRect().bottom + 12;
                topPos = Math.max(topPos, headerBottom);
                //Set position
                content.style.left = leftPos + "px";
                content.style.top = topPos + "px";

            }
            displayProgress("Sampler completed with distance " + distanceBetweenContent + " w: " + poissonSize[0] + " h: " + poissonSize[1]);
        }

        //Border detection and movement
        function borderDetection(content) {
            var rightEdge = content.getBoundingClientRect().right;
            if (rightEdge > getWindowSize().width) {
                var offset = getWindowSize().width - rightEdge;
                displayProgress("Woah! Moving content because it fell off right edge", [content, offset]);
                var newLeftPos = content.getBoundingClientRect().left + (offset - 16);
                content.style.left = newLeftPos + "px";
            }
        }

        function setUpWindowSizeCalc() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
            let vw = window.innerWidth * 0.01;
            document.documentElement.style.setProperty('--vw', `${vw}px`);
        }

        // ðŸš¦ USER DRIVEN UPDATES 

        function setupVideoHover() {
            var videoElements = document.getElementsByTagName("video");
            for (var i = 0; i < videoElements.length; i++) {
                let videoElement = videoElements[i];
                let contentMain = videoElement.parentElement;
                let containerElement = contentMain.parentElement;
                containerElement.addEventListener("mouseover", () => {
                    onVideoElHover(videoElement);
                })
                containerElement.addEventListener("mouseout", () => {
                    onVideoElLeave(videoElement);
                })
            }

            function onVideoElHover(videoEl) {
                var promise = videoEl.play();
                if (promise !== undefined) {
                    promise.then(function() {
                        console.log("Whatever")
                    }).catch(function(error) {
                        console.log("The video isnt going to play on hover")
                    });
                }
            }

            function onVideoElLeave(videoEl) {
                videoEl.pause();
            }
        }

        function setCaptionColor() {
            var bgColorHSL = getComputedStyle(document.documentElement)
                .getPropertyValue('--BGColor');


            var bgFrontPart = bgColorHSL.split(",")[0] + "," + bgColorHSL.split(",")[1];
            var bgLightnessStr = bgColorHSL.split(",")[2].split(")")[0].split("%")[0].trim();
            var bgLightness = parseInt(bgLightnessStr);

            var newLightness = 95;
            var newHSL = `${bgFrontPart},${newLightness}%)`;


            document.documentElement.style.setProperty('--CaptionColor', newHSL);
        }


        var saturation = 100;
        var lightness = 50;

        function updateColorHue(color, newHue) {
            var newHSL = "hsl(" + newHue + ", 100%, 50%)";
            var colorVaraible = "--" + color;
            document.documentElement.style.setProperty(colorVaraible, newHSL);

            if (color == "BrushColor" && isDesktop()) {
                setCanvasBrushColor();
            }

            if (color == "BGColor") {
                setCaptionColor();
            }
        }

        //ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ CANVAS!

        var canvas, isOver;

        function createCanvas() {
            canvas = new fabric.Canvas("draw-canvas", {
                isDrawingMode: true,
                hoverCursor: "pointer"
            });
            setCanvasSize();
            setCanvasBrushColor();
        }

        function setCanvasBrushColor() {
            var color = getComputedStyle(document.documentElement)
                .getPropertyValue('--BrushColor'); // #999999
            canvas.freeDrawingBrush.color = color;
        }

        function setCanvasSize() {
            canvas.setHeight(window.innerHeight);
            canvas.setWidth(window.innerWidth);
        }

        //Time because im so lazy
        function startTime() {
            var format = 'h:m a';
            var timeZone = "America/New_York";
            var timeString = moment().tz(timeZone).format(format);
            document.getElementById("clock").innerHTML = timeString;
            setTimeout(startTime, 50000);
        }

        startTime();

        setTimeout(setup(), 500);
    </script>
</body>

</html>