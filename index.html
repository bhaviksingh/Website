<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>bvk</title>
    <link rel="shortcut icon" href="favicon.png" type="image/png" sizes="24x24">
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="jslib/poisson.js"></script>
    <script src="jslib/fabric.min.js"></script>

    <script src="jslib/utils.js">
        setUpWindowSizeCalc();
        // This correct sets VW and VH as necessary
    </script>
</head>

<body>
    <div id="header">
        <div id="logo"> </div>
        <div id="content"> Bhavik is an artist & technologist interested in creating digital experiences that help you express and understand yourself. </div>
    </div>
    <div id="container">
        <div id="content-holder">
            <div class="content phone" data-priority="1.5">
                <div class="content-caption"> Bento </div>
                <div class="content-main"> <img draggable="false" src="Images/home/bento.png" alt="An image" /> </div>
            </div>
            <div class="content browser" data-priority="1">
                <div class="content-caption"> breathe </div>
                <div class="content-main"> <img draggable="false" src="Images/home/breathe.png" alt="An image" /> </div>
            </div>
            <div class="content browser" data-priority="1">
                <div class="content-caption"> emoji kitchen </div>
                <div class="content-main"> <img draggable="false" src="Images/home/emoji-kitchen.png" alt="An image" /> </div>
            </div>
            <div class="content phone" data-priority="2">
                <div class="content-caption"> mag </div>
                <div class="content-main"> <img draggable="false" src="Images/home/expression-mag.png" alt="An image" /> </div>
            </div>
            <div class="content paper" data-priority="2">
                <div class="content-caption"> dinner at ians</div>
                <div class="content-main"> <img draggable="false" src="Images/home/ians.png" alt="An image" /> </div>
            </div>
            <div class="content phone" data-priority="2">
                <div class="content-caption"> minis </div>
                <div class="content-main"> <img draggable="false" src="Images/home/mini.png" alt="An image" /> </div>
            </div>
            <div class="content paper" data-priority="2">
                <div class="content-caption"> shandar phool </div>
                <div class="content-main"> <img draggable="false" src="Images/home/shandar-phool.png" alt="An image" /> </div>
            </div>
            <div class="content browser" data-priority="1">
                <div class="content-caption"> shared-room </div>
                <div class="content-main"> <img draggable="false" src="Images/home/shared-room.png" alt="An image" /> </div>
            </div>
            <div class="content phone" data-priority="2">
                <div class="content-caption"> shoelace </div>
                <div class="content-main"> <img draggable="false" src="Images/home/shoelace.png" alt="An image" /> </div>
            </div>
            <div class="content paper" data-priority="2">
                <div class="content-caption"> slow life </div>
                <div class="content-main"> <img draggable="false" src="Images/home/slow-life.png" alt="An image" /> </div>
            </div>
            <div class="content browser" data-priority="2">
                <div class="content-caption"> smishy </div>
                <div class="content-main"> <img draggable="false" src="Images/home/smishy.png" alt="An image" /> </div>
            </div>
        </div>
        <div id="canvas-holder">
            <canvas id="draw-canvas"></canvas>
        </div>
    </div>
    <script>
        displayProgress(" JS is starting");
        var contentHolder = document.getElementById("content-holder");
        var contentPieces = contentHolder.children;



        function makeDraggable(content) {
            let mouseDown = false;
            content.addEventListener("mousedown", () => {
                mouseDown = true;
            })
            document.addEventListener("mouseup", () => {
                mouseDown = false;
            });
            document.addEventListener("mousemove", (e) => {
                if (mouseDown) {
                    displayProgress("Moving the content", [e, content]);
                    var xPos = e.pageX;
                    var yPos = e.pageY;
                    content.style.left = xPos + "px";
                    content.style.top = yPos + "px";
                }
            })
        }

        //TODO make this more like legit and not jank
        function getImageForContent(content) {
            var contentMain = content.children[1];
            var contentImg = contentMain.children[0];
            return contentImg;
        }

        var windowSizeFactor = .4;
        var totalDiagonal = 0,
            totalArea = 0;

        function resizeContent(content) {
            //First figure out if it has an image
            var contentImage = getImageForContent(content);
            if (!contentImage)
                return;

            //Get the priority of the image, default to 1
            var priority = content.dataset.priority;
            if (!priority)
                priority = 1;

            //Set the major/minor axis according to the aspect ratio of the image
            var sizeFactor = windowSizeFactor / priority;
            var majorAxisLength;
            if (contentImage.clientWidth > contentImage.clientHeight) {
                majorAxisLength = sizeFactor * window.innerWidth;
                contentImage.style.width = majorAxisLength + "px";
                contentImage.style.height = "auto"
            } else {
                majorAxisLength = sizeFactor * window.innerWidth;
                contentImage.style.height = majorAxisLength + "px";
                contentImage.style.width = "auto"
            }

            //Calculate some major functions for later
            var contentWidth = contentImage.clientWidth;
            var contentHeight = contentImage.clientHeight;
            var contentDiagonal = Math.sqrt(Math.pow(contentWidth, 2) + Math.pow(contentHeight, 2));
            totalDiagonal += contentDiagonal;
            totalArea += contentWidth * contentHeight;

            displayProgress("Resizing /content to " + majorAxisLength, [contentImage]);
        }


        function layoutContent(poissonSize, distanceBetweenContent) {
            var sampler = poissonDiscSampler(poissonSize[0], poissonSize[1], distanceBetweenContent);
            displayProgress("Sampler initiated with distance " + distanceBetweenContent + " w: " + poissonSize[0] + " h: " + poissonSize[1]);

            for (var i = 0; i < contentPieces.length; i++) {
                var sample = sampler();
                if (!sample) {
                    displayWarning("Bad stuff, trying again");
                    layoutContent(poissonSize, distanceBetweenContent - 10);
                    return;
                }

                var content = contentPieces[i];

                //Left right edge detection and move
                var leftPos = sample[0],
                    topPos = sample[1];

                //TODO: FIX THIS
                var boundingBox = content.getBoundingClientRect();
                if (boundingBox.right > poissonSize[1]) {
                    console.log(content);
                    console.log(boundingBox);
                }

                //Set position
                content.style.left = sample[0] + "px";
                content.style.top = sample[1] + "px";

            }
        }


        function setUpWindowSizeCalc() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
            let vw = window.innerWidth * 0.01;
            document.documentElement.style.setProperty('--vw', `${vw}px`);
        }

        function setup() {
            setUpWindowSizeCalc();
            for (var i = 0; i < contentPieces.length; i++) {
                var content = contentPieces[i];
                resizeContent(content);
                makeDraggable(content);
            }
            var areaSize = [contentHolder.clientWidth, contentHolder.clientHeight];
            var averageDiagonal = 0.5 * contentHolder.clientHeight;
            var areaForContent = [0.8 * areaSize[0], 2 * areaSize[1]];
            layoutContent(areaForContent, averageDiagonal);
        }
        setup();
        window.addEventListener("resize", () => setup());


        //Related to drawing and  canvas
        var canvas = new fabric.Canvas("draw-canvas", {
            isDrawingMode: true
        });

        function setCanvasSize() {
            canvas.setHeight(window.innerHeight);
            canvas.setWidth(window.innerWidth);
        }
        setCanvasSize();
        window.addEventListener("resize", () => setCanvasSize());
    </script>
    ]
</body>

</html>